var Emitter=function(){function n(){this._listeners={},this._flags={}}function t(n,t){var e=t.split(".");t=e.shift();var a={_args:_(arguments,2)};e.length&&(a._namespaces=e);var i=n[t]||(n[t]=r());i.push(a)}function r(){var n=[];return n._depth=0,n._removed=0,n}function e(n,t,r){function e(n){i(r,n._args,l,o)}var l=n._listeners,f=t.split(".");t=f.shift(),f.length&&(r._namespaces=f),r.calls=0;var u=l[t]||(l[t]=a()),o=u.push(r)-1;s(e,n,t,f)}function a(){var n=[];return n._removed=0,n._depth=0,n}function i(n,t,r,e){n.callback.apply(null,t),++n.calls==n.maxCalls&&l(n,r,e)}function l(n,t,r){t[r]=null,t._removed++}function f(n,t,r,e){function a(n,t,r){return!(!n||t&&t!=n.callback||r&&!u(r,n._namespaces))}if(r){var i=r.split(".");r=i.shift(),i=i.length?i:null;var l=t[r];if(l){l._depth++;for(var s=0,c=l.length;c>s;++s){var v=l[s];if(a(v,e,i)&&(n.call(null,v,l,s),e))break}0==--l._depth&&o(l)}}else for(r in t)f(n,t,r,e)}function s(n,t,r,e){if(r){e||(e=r.split("."),r=e.shift());var a=t._flags[r];if(a){a._depth++;for(var i=0,l=a.length;l>i;++i){var f=a[i];f&&u(f._namespaces,e)&&n.call(null,f,a,i)}0==--a._depth&&o(a)}}else for(r in events)s(n,t,r)}function u(n,t){var r;if(!n||0==(r=n.length))return!0;if(!t||t.length<r||-1==t.indexOf(n[0]))return!1;for(var e=1;r>e;++e)if(-1==t.indexOf(n[e]))return!1;return!0}function o(n){n._removed&&(c(n),n._removed=0)}function c(n){for(var t=0,r=0,e=n.length;e>t;++t){var a=n[t];a&&(n[r++]=a)}n.length=r}function v(n){for(var t=0,r=n.length;r>t;++t){var e=n[t];if(!e)return!1}return!0}function h(n){for(var t in n)if(!v(n[t]))return!1;return!0}function _(n,t){t=t||0;var r=n.length,e=r-t;if(0>=e)return[];for(var a=Array(e),i=t,l=0;r>i;++i,++l)a[l]=n[i];return a}var g=n.prototype;return g.on=function(n,t){var r=t.callback?t:{callback:t};e(this,n,r)},g.off=function(n,t){f(l,this._listeners,n,t)},g.trigger=function(n){function t(n,t,r){i(n,e,t,r)}var r=this._listeners,e=_(arguments,1);f(t,r,n)},g.once=function(n,t){var r={callback:t,maxCalls:1};e(this,n,r)},g.flag=function(){var n=_(arguments);n.unshift(this._flags),t.apply(null,n),g.trigger.apply(this,arguments)},g.unflag=function(n){function t(n,t,r){t[r]=null,t._removed++}s(t,this,n)},g._isCompact=function(){return h(this._listeners)&&h(this._flags)},n}();